{% extends "base.html" %}
{% block content %}

<div class="h-full flex flex-col overflow-hidden">

    <div class="flex-1 overflow-auto">
        <div class="m-4 grid grid-cols-1 lg:grid-cols-2 gap-4">
            <!-- Información del sector -->

            <div class="p-4 border border-gray-300 rounded-lg shadow-sm relative">
                <h2 class="text-lg font-semibold mb-3">Ubicación</h2>
                <div id="map" class="w-full h-64 rounded-lg"></div>

                <!-- Botón personalizado -->
                <button id="toggleLayer"
                    class="absolute top-16 right-6 z-1000 bg-white hover:bg-gray-100 px-3 py-2 rounded-lg shadow-md border border-gray-300 text-sm font-medium transition-colors">
                    <i class="fa-solid fa-layer-group"></i>
                    <span id="layerName">Satélite</span>
                </button>
            </div>

        </div>

        <!-- Aquí puedes agregar más secciones: gráficos, historial, etc. -->
    </div>
</div>


<script>
    const lat = {{ sector.latitud }};
    const lng = {{ sector.longitud }};

    const map = L.map('map', {
        center: [lat, lng],
        zoom: 16,
        scrollWheelZoom: true,
        dragging: true,
        touchZoom: true,
        doubleClickZoom: true,
        boxZoom: true,
        keyboard: false,
        zoomControl: true
    });

    // Definir las capas de tiles
    const openStreetMap = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '© OpenStreetMap contributors'
    });

    const esriSatellite = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
        attribution: 'Tiles © Esri',
        maxZoom: 18
    });

    // Agregar la capa por defecto
    let currentLayer = openStreetMap;
    currentLayer.addTo(map);

    // Botón para cambiar capas
    document.getElementById('toggleLayer').addEventListener('click', function () {
        const layerNameSpan = document.getElementById('layerName');

        if (currentLayer === openStreetMap) {
            map.removeLayer(openStreetMap);
            esriSatellite.addTo(map);
            currentLayer = esriSatellite;
            layerNameSpan.textContent = 'Mapa';
        } else {
            map.removeLayer(esriSatellite);
            openStreetMap.addTo(map);
            currentLayer = openStreetMap;
            layerNameSpan.textContent = 'Satélite';
        }
    });

    // Marcador fijo
    const marker = L.marker([lat, lng], {
        draggable: false
    }).addTo(map);

    marker.bindPopup(`
        <div class="text-center">
            <strong>Sector {{ sector.id }}</strong><br>
            <span class="text-sm">Lat: ${lat}</span><br>
            <span class="text-sm">Lng: ${lng}</span>
        </div>
    `);
</script>

{% endblock %}